"use strict";(self.webpackChunkuiv_2=self.webpackChunkuiv_2||[]).push([[7695],{1208:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/s3table-firehose-lambda-architecture-ed9ce43ab8d5e9cf3241b54f2a4fc265.png"},6980:e=>{e.exports=JSON.parse('{"permalink":"/blog/s3-tables-streaming-analytics","source":"@site/blog/2026-01-25-s3-tables-streaming-analytics.mdx","title":"Serverless Streaming Analytics with S3 Tables & Firehose","description":"Build a production-ready serverless streaming analytics pipeline using Amazon S3 Tables and Kinesis Data Firehose. Query 600K records/hour with Apache Iceberg format, automated governance, and zero infrastructure management.","date":"2026-01-25T00:00:00.000Z","tags":[{"inline":true,"label":"aws","permalink":"/blog/tags/aws"},{"inline":true,"label":"serverless","permalink":"/blog/tags/serverless"},{"inline":true,"label":"streaming analytics","permalink":"/blog/tags/streaming-analytics"},{"inline":true,"label":"amazon bedrock","permalink":"/blog/tags/amazon-bedrock"},{"inline":true,"label":"s3 tables","permalink":"/blog/tags/s-3-tables"},{"inline":true,"label":"kinesis","permalink":"/blog/tags/kinesis"},{"inline":true,"label":"apache iceberg","permalink":"/blog/tags/apache-iceberg"},{"inline":true,"label":"terraform","permalink":"/blog/tags/terraform"},{"inline":true,"label":"iot","permalink":"/blog/tags/iot"},{"inline":true,"label":"data governance","permalink":"/blog/tags/data-governance"}],"readingTime":8.14,"hasTruncateMarker":true,"authors":[{"name":"Manu Mishra","title":"Solutions Architect & Applied Software Engineer","url":"https://github.com/manu-mishra","imageURL":"/img/logo.png","key":"manu","page":null}],"frontMatter":{"slug":"s3-tables-streaming-analytics","title":"Serverless Streaming Analytics with S3 Tables & Firehose","description":"Build a production-ready serverless streaming analytics pipeline using Amazon S3 Tables and Kinesis Data Firehose. Query 600K records/hour with Apache Iceberg format, automated governance, and zero infrastructure management.","keywords":["amazon s3 tables","kinesis data firehose","streaming analytics","apache iceberg","serverless","aws lambda","lake formation","real-time analytics","iot data","terraform"],"image":"/img/blog/s3table-firehose-lambda-architecture.png","authors":"manu","tags":["aws","serverless","streaming analytics","amazon bedrock","s3 tables","kinesis","apache iceberg","terraform","iot","data governance"],"date":"2026-01-25T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Universal Image MCP - One Server, Three AI Image Providers","permalink":"/blog/universal-image-mcp-multi-provider-image-generation"},"nextItem":{"title":"Recursive Language Models on AWS with Strands Agents","permalink":"/blog/recursive-language-models-strands-agentcore"}}')},7269:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});var r=i(6980),s=i(4848),a=i(8453);const t={slug:"s3-tables-streaming-analytics",title:"Serverless Streaming Analytics with S3 Tables & Firehose",description:"Build a production-ready serverless streaming analytics pipeline using Amazon S3 Tables and Kinesis Data Firehose. Query 600K records/hour with Apache Iceberg format, automated governance, and zero infrastructure management.",keywords:["amazon s3 tables","kinesis data firehose","streaming analytics","apache iceberg","serverless","aws lambda","lake formation","real-time analytics","iot data","terraform"],image:"/img/blog/s3table-firehose-lambda-architecture.png",authors:"manu",tags:["aws","serverless","streaming analytics","amazon bedrock","s3 tables","kinesis","apache iceberg","terraform","iot","data governance"],date:new Date("2026-01-25T00:00:00.000Z")},o=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Introduction",id:"introduction",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Key Components",id:"key-components",level:2},{value:"Data Generation Layer",id:"data-generation-layer",level:3},{value:"Streaming Layer",id:"streaming-layer",level:3},{value:"Storage Layer",id:"storage-layer",level:3},{value:"Governance Layer",id:"governance-layer",level:3},{value:"Monitoring Layer",id:"monitoring-layer",level:3},{value:"Data Schema",id:"data-schema",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"One-Time Account Configuration",id:"one-time-account-configuration",level:3},{value:"Required Tools",id:"required-tools",level:3},{value:"Validation Script",id:"validation-script",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Infrastructure as Code",id:"infrastructure-as-code",level:3},{value:"Deployment Steps",id:"deployment-steps",level:3},{value:"Verification",id:"verification",level:3},{value:"Querying Data",id:"querying-data",level:2},{value:"View All Sensor Data",id:"view-all-sensor-data",level:3},{value:"Average Temperature by Location",id:"average-temperature-by-location",level:3},{value:"Recent High Temperature Alerts",id:"recent-high-temperature-alerts",level:3},{value:"Sensor Activity Summary",id:"sensor-activity-summary",level:3},{value:"Monitoring and Operations",id:"monitoring-and-operations",level:2},{value:"CloudWatch Dashboard",id:"cloudwatch-dashboard",level:3},{value:"Error Monitoring",id:"error-monitoring",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Encryption",id:"encryption",level:3},{value:"Access Control",id:"access-control",level:3},{value:"Cost Optimization",id:"cost-optimization",level:2},{value:"Technical Implementation Notes",id:"technical-implementation-notes",level:2},{value:"Schema Definition",id:"schema-definition",level:3},{value:"Lake Formation Permissions",id:"lake-formation-permissions",level:3},{value:"Firehose Buffering",id:"firehose-buffering",level:3},{value:"Cleanup",id:"cleanup",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"S3 Tables Architecture",src:i(1208).A+"",width:"1536",height:"1024"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"Modern businesses need to analyze streaming data in real-time to make faster decisions. Whether it's monitoring IoT sensors, tracking user behavior, or processing financial transactions, the ability to query fresh data immediately is critical. However, building a streaming analytics pipeline traditionally requires managing complex infrastructure and dealing with data format conversions."}),"\n",(0,s.jsxs)(n.p,{children:["This solution shows how to build a serverless real-time streaming analytics pipeline using ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/s3/features/tables/",children:"Amazon S3 Tables"})," and ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/kinesis/data-firehose/",children:"Amazon Kinesis Data Firehose"}),". By combining streaming ingestion with Apache Iceberg's analytics-optimized format, you can query data within minutes of generation\u2014without managing any servers or data transformation jobs."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"GitHub Repository:"})," ",(0,s.jsx)(n.a,{href:"https://github.com/manu-mishra/s3table-firehose-lambda-terraform-demo",children:"https://github.com/manu-mishra/s3table-firehose-lambda-terraform-demo"})]}),"\n","\n",(0,s.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,s.jsxs)(n.p,{children:["The solution creates an end-to-end streaming analytics pipeline that generates IoT sensor data using ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/lambda/",children:"AWS Lambda"}),", simulating 10 sensors across multiple locations. Data streams continuously through Amazon Kinesis Data Firehose with automatic buffering and delivery, then gets stored in Apache Iceberg format using Amazon S3 Tables for optimized analytics performance. The solution integrates with ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/lake-formation/",children:"AWS Lake Formation"})," for centralized data governance and access control."]}),"\n",(0,s.jsxs)(n.p,{children:["The solution generates approximately ",(0,s.jsx)(n.strong,{children:"600,000 records per hour"})," from simulated IoT sensors, demonstrating real-world streaming data patterns for temperature, humidity, and pressure monitoring across warehouse and office locations."]}),"\n",(0,s.jsx)(n.h2,{id:"key-components",children:"Key Components"}),"\n",(0,s.jsx)(n.h3,{id:"data-generation-layer",children:"Data Generation Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"AWS Lambda"})," (512 MB memory) generates 10,000 IoT sensor records per invocation at a rate of 200 records per second. The function is triggered every minute by ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/eventbridge/",children:"Amazon EventBridge"}),", producing consistent data flow for the pipeline. An ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/iam/",children:"AWS Identity and Access Management (IAM)"})," role grants the Lambda function permissions to write to Firehose and ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/cloudwatch/",children:"Amazon CloudWatch"})," Logs."]}),"\n",(0,s.jsx)(n.h3,{id:"streaming-layer",children:"Streaming Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Amazon Kinesis Data Firehose"})," buffers incoming data for up to 5 minutes or 5 MB before writing to the destination. An IAM role provides Firehose with permissions to access S3 Tables via Lake Formation, write to the error bucket, and use ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/kms/",children:"AWS Key Management Service (AWS KMS)"})," for encryption."]}),"\n",(0,s.jsx)(n.h3,{id:"storage-layer",children:"Storage Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Amazon S3 Tables"})," stores data in Apache Iceberg format with automatic schema management and table optimization. The table bucket is encrypted using AWS KMS customer-managed keys."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Amazon Simple Storage Service (Amazon S3) Error Bucket"})," captures failed deliveries from Firehose when records cannot be written to S3 Tables. The error bucket is encrypted with AWS KMS customer-managed keys and has versioning enabled for audit trails. Failed records are written to the ",(0,s.jsx)(n.code,{children:"errors/"})," prefix with metadata about the failure reason, enabling troubleshooting and data recovery."]}),"\n",(0,s.jsx)(n.h3,{id:"governance-layer",children:"Governance Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"AWS Lake Formation"})," grants explicit permissions (ALL, ALTER, DELETE, DESCRIBE, DROP, INSERT, SELECT) to the Firehose role for database, table, and column access, ensuring secure and governed data access patterns."]}),"\n",(0,s.jsx)(n.h3,{id:"monitoring-layer",children:"Monitoring Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Amazon CloudWatch Dashboard"})," provides real-time monitoring of Firehose metrics, Lambda performance, and S3 Tables storage with 9 pre-configured widgets tracking key operational metrics."]}),"\n",(0,s.jsx)(n.h2,{id:"data-schema",children:"Data Schema"}),"\n",(0,s.jsx)(n.p,{children:"The solution generates IoT sensor data with the following schema:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"sensor_id"})," (string): Unique identifier for each sensor"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"timestamp"})," (long): Unix timestamp in seconds"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"location"})," (string): Physical location of the sensor"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"temperature"})," (double): Temperature reading in Celsius"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"humidity"})," (double): Humidity percentage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"pressure"})," (double): Atmospheric pressure in hPa"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Data generation rate: 200 records per second during Lambda execution, producing approximately 10,000 records per invocation and 600,000 records per hour across all sensors."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.h3,{id:"one-time-account-configuration",children:"One-Time Account Configuration"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Enable S3 Tables Integration with Lake Formation"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Navigate to the ",(0,s.jsx)(n.a,{href:"https://console.aws.amazon.com/s3/",children:"Amazon S3 console"})]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.strong,{children:"Table buckets"})," in the left navigation"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Enable integration"})]}),"\n",(0,s.jsx)(n.li,{children:"This registers S3 Tables with AWS Lake Formation"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configure Lake Formation Administrator Permissions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The IAM identity running Terraform requires Lake Formation administrator permissions"}),"\n",(0,s.jsxs)(n.li,{children:["Navigate to the ",(0,s.jsx)(n.a,{href:"https://console.aws.amazon.com/lakeformation/",children:"AWS Lake Formation console"})]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.strong,{children:"Administrative roles and tasks"})," \u2192 ",(0,s.jsx)(n.strong,{children:"Choose administrators"})]}),"\n",(0,s.jsx)(n.li,{children:"Add your IAM user or role"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Alternatively, use the AWS CLI:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'aws lakeformation put-data-lake-settings \\\n  --data-lake-settings \'{"DataLakeAdmins":[{"DataLakePrincipalIdentifier":"arn:aws:iam::ACCOUNT:user/YOUR_USER"}]}\'\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"required-tools",children:"Required Tools"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://www.terraform.io/",children:"Terraform"})," >= 1.0"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://aws.amazon.com/cli/",children:"AWS Command Line Interface (AWS CLI)"})," >= 2.15 (for S3 Tables support)"]}),"\n",(0,s.jsx)(n.li,{children:"AWS credentials configured"}),"\n",(0,s.jsx)(n.li,{children:"Terraform AWS Provider >= 6.0 (for S3 Tables schema support)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"validation-script",children:"Validation Script"}),"\n",(0,s.jsx)(n.p,{children:"The solution includes a validation script to verify all prerequisites before deployment:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./validate-prerequisites.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"This script checks:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"AWS credentials configuration"}),"\n",(0,s.jsx)(n.li,{children:"S3 Tables integration with Lake Formation is enabled"}),"\n",(0,s.jsx)(n.li,{children:"Current IAM identity is a Lake Formation administrator"}),"\n",(0,s.jsx)(n.li,{children:"Required IAM permissions are available"}),"\n",(0,s.jsx)(n.li,{children:"AWS CLI version supports S3 Tables (v2.15+)"}),"\n",(0,s.jsx)(n.li,{children:"Terraform is installed (v1.0+)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,s.jsx)(n.h3,{id:"infrastructure-as-code",children:"Infrastructure as Code"}),"\n",(0,s.jsxs)(n.p,{children:["The solution uses ",(0,s.jsx)(n.a,{href:"https://www.terraform.io/",children:"Terraform"})," to provision all AWS resources. The deployment creates:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"S3 Tables table bucket, namespace, and Iceberg table with schema (KMS encrypted)"}),"\n",(0,s.jsx)(n.li,{children:"Kinesis Data Firehose delivery stream with Iceberg destination"}),"\n",(0,s.jsx)(n.li,{children:"Amazon S3 error bucket for failed deliveries (KMS encrypted)"}),"\n",(0,s.jsx)(n.li,{children:"AWS Lambda data generator function (512 MB, triggered every minute)"}),"\n",(0,s.jsx)(n.li,{children:"Amazon EventBridge schedule rule"}),"\n",(0,s.jsx)(n.li,{children:"IAM roles and policies for Firehose and Lambda"}),"\n",(0,s.jsx)(n.li,{children:"AWS KMS customer-managed encryption key"}),"\n",(0,s.jsx)(n.li,{children:"Amazon CloudWatch dashboard with 9 monitoring widgets"}),"\n",(0,s.jsx)(n.li,{children:"AWS Lake Formation permissions (automated via Terraform)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"deployment-steps",children:"Deployment Steps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Configure ",(0,s.jsx)(n.code,{children:"terraform.tfvars"})," with your stack name (must be globally unique):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-hcl",children:'stack_name = "your-unique-stack-name"\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Deploy the infrastructure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"terraform init\nterraform apply\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"All resources are created with Lake Formation permissions automatically granted during deployment."}),"\n",(0,s.jsx)(n.h3,{id:"verification",children:"Verification"}),"\n",(0,s.jsx)(n.p,{children:"Lambda begins sending data immediately. Wait 5-6 minutes for Firehose buffering, then verify data flow using the Amazon CloudWatch dashboard. The dashboard provides real-time visibility into:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Firehose incoming records and delivery metrics"}),"\n",(0,s.jsx)(n.li,{children:"Lambda invocations and performance"}),"\n",(0,s.jsx)(n.li,{children:"S3 Tables storage growth"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Access the dashboard URL from Terraform outputs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"terraform output dashboard_url\n"})}),"\n",(0,s.jsx)(n.p,{children:"Alternatively, check for delivery errors:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"aws s3 ls s3://{stack_name}-errors/errors/ --recursive\n"})}),"\n",(0,s.jsx)(n.p,{children:"An empty result indicates successful data delivery."}),"\n",(0,s.jsx)(n.h2,{id:"querying-data",children:"Querying Data"}),"\n",(0,s.jsx)(n.p,{children:"After deployment, query the streaming data stored in S3 Tables using Apache Iceberg-compatible query engines:"}),"\n",(0,s.jsx)(n.h3,{id:"view-all-sensor-data",children:"View All Sensor Data"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM firehosetos3demo.firehosetos3demo LIMIT 100;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"average-temperature-by-location",children:"Average Temperature by Location"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT \n    location, \n    AVG(temperature) as avg_temp,\n    COUNT(*) as reading_count\nFROM firehosetos3demo.firehosetos3demo\nGROUP BY location\nORDER BY avg_temp DESC;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"recent-high-temperature-alerts",children:"Recent High Temperature Alerts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT \n    sensor_id, \n    temperature, \n    humidity,\n    timestamp,\n    from_unixtime(timestamp) as reading_time\nFROM firehosetos3demo.firehosetos3demo\nWHERE temperature > 25\nORDER BY timestamp DESC\nLIMIT 50;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"sensor-activity-summary",children:"Sensor Activity Summary"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT \n    sensor_id,\n    location,\n    COUNT(*) as total_readings,\n    AVG(temperature) as avg_temp,\n    AVG(humidity) as avg_humidity,\n    MIN(timestamp) as first_reading,\n    MAX(timestamp) as last_reading\nFROM firehosetos3demo.firehosetos3demo\nGROUP BY sensor_id, location\nORDER BY sensor_id;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"monitoring-and-operations",children:"Monitoring and Operations"}),"\n",(0,s.jsx)(n.h3,{id:"cloudwatch-dashboard",children:"CloudWatch Dashboard"}),"\n",(0,s.jsx)(n.p,{children:"The solution includes a pre-configured Amazon CloudWatch dashboard with the following metrics:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Firehose Metrics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Incoming records"}),"\n",(0,s.jsx)(n.li,{children:"Delivery success/failure counts"}),"\n",(0,s.jsx)(n.li,{children:"Data freshness (time from arrival to delivery)"}),"\n",(0,s.jsx)(n.li,{children:"Bytes delivered"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Lambda Metrics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Invocations"}),"\n",(0,s.jsx)(n.li,{children:"Errors"}),"\n",(0,s.jsx)(n.li,{children:"Duration"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"S3 Tables Metrics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Storage size"}),"\n",(0,s.jsx)(n.li,{children:"File count"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Access the dashboard URL from Terraform outputs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"terraform output dashboard_url\n"})}),"\n",(0,s.jsx)(n.h3,{id:"error-monitoring",children:"Error Monitoring"}),"\n",(0,s.jsx)(n.p,{children:"Check for delivery failures:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"aws s3 ls s3://{stack_name}-errors/errors/iceberg-failed/ --recursive\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"encryption",children:"Encryption"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"At Rest"}),": All data in S3 Tables and the error bucket is encrypted using AWS KMS customer-managed keys with automatic key rotation enabled"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"In Transit"}),": All data transfers use TLS encryption"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"access-control",children:"Access Control"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"IAM Roles"}),": Least-privilege IAM policies for Lambda and Firehose"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lake Formation"}),": Fine-grained access control at database, table, and column levels"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"KMS Key Policies"}),": Explicit permissions for service principals and roles"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"cost-optimization",children:"Cost Optimization"}),"\n",(0,s.jsx)(n.p,{children:"The solution implements several cost optimization strategies:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Firehose Buffering"}),": 5-minute or 5 MB buffering reduces the number of small files written to S3 Tables"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CloudWatch Logs Retention"}),": 1-day retention for Lambda logs reduces storage costs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"S3 Tables Maintenance"}),": Automatic compaction and optimization reduce storage costs over time"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"technical-implementation-notes",children:"Technical Implementation Notes"}),"\n",(0,s.jsx)(n.h3,{id:"schema-definition",children:"Schema Definition"}),"\n",(0,s.jsxs)(n.p,{children:["Amazon Kinesis Data Firehose requires S3 Tables to have a pre-defined schema. The solution uses Terraform AWS Provider 6.0+ which supports schema definition via the ",(0,s.jsx)(n.code,{children:"metadata"})," block:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-hcl",children:'metadata {\n  iceberg {\n    schema {\n      field {\n        name     = "sensor_id"\n        type     = "string"\n        required = false\n      }\n      # Additional fields...\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"lake-formation-permissions",children:"Lake Formation Permissions"}),"\n",(0,s.jsxs)(n.p,{children:["The solution uses Terraform's ",(0,s.jsx)(n.code,{children:"null_resource"})," with ",(0,s.jsx)(n.code,{children:"local-exec"})," provisioner to automatically grant Lake Formation permissions using the AWS CLI during deployment. This approach is necessary because Terraform's ",(0,s.jsx)(n.code,{children:"aws_lakeformation_permissions"})," resource does not support S3 Tables catalog ARNs (format: ",(0,s.jsx)(n.code,{children:"account:s3tablescatalog/bucket-name"}),")."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"null_resource"})," executes after the foundational resources (S3 Tables, IAM roles) are created but before the Firehose delivery stream is provisioned. This ensures the Firehose role has the required Lake Formation permissions (ALL, ALTER, DELETE, DESCRIBE, DROP, INSERT, SELECT) for database, table, and column access before attempting to write data."]}),"\n",(0,s.jsxs)(n.p,{children:["Without these permissions, Firehose would fail with ",(0,s.jsx)(n.code,{children:"Lakeformation.AccessDenied"})," errors when attempting to write to S3 Tables. The automated approach eliminates manual permission configuration and ensures consistent deployments."]}),"\n",(0,s.jsx)(n.h3,{id:"firehose-buffering",children:"Firehose Buffering"}),"\n",(0,s.jsx)(n.p,{children:"Amazon Kinesis Data Firehose buffers data for up to 5 minutes (300 seconds) or 5 MB before writing to S3 Tables. This buffering mechanism optimizes write performance and reduces the number of small files, which improves query performance and reduces costs."}),"\n",(0,s.jsx)(n.h2,{id:"cleanup",children:"Cleanup"}),"\n",(0,s.jsx)(n.p,{children:"To remove all resources:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"terraform destroy\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": The AWS KMS key will be scheduled for deletion with a 7-day waiting period (AWS minimum)."]}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"This solution demonstrates a production-ready pattern for streaming data ingestion into Amazon S3 Tables using Amazon Kinesis Data Firehose. The architecture provides automatic buffering, schema management, encryption, governance, and monitoring capabilities suitable for real-world analytics workloads. The use of Apache Iceberg format through S3 Tables enables efficient querying, ACID transactions, and time travel capabilities for your streaming data."}),"\n",(0,s.jsx)(n.p,{children:"By combining serverless compute (Lambda), managed streaming (Firehose), and analytics-optimized storage (S3 Tables), you can build scalable real-time analytics pipelines without managing infrastructure. The solution processes 600,000 records per hour with sub-minute query latency, demonstrating the power of modern serverless data architectures on AWS."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var r=i(6540);const s={},a=r.createContext(s);function t(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);